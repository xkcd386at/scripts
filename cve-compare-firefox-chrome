#!/bin/bash

# compare firefox and chrome CVEs
# $1 is from https://nvd.nist.gov/feeds/json/cve/1.1/nvdcve-1.1-2021.json.gz or similar; see https://nvd.nist.gov/vuln/data-feeds for more

# XXX: that "cpe:2.3" may need to be tweaked; I have no idea what it is or how stable it is!

zcat -f "$1" |
    gron |
    perl -pE 'say "" if /json.CVE_Items\[\d+\] = / ' |
    perl -00 -nE '
        next unless /cpe:2.3:a:google:chrome:/ or /cpe:2.3:a:mozilla:firefox:/;
        $b = "chrome"  if /cpe:2.3:a:google:chrome:/;
        $b = "firefox" if /cpe:2.3:a:mozilla:firefox:/;
        $s = $1 if /baseSeverity = "(\w+)"/;
        say "$b $s" unless $s eq "LOW";

        $b =  ""; $s = "";
    ' | datamash -W -s crosstab 1,2 | expand -16
